{% extends 'base.html' %} {% block head %} {% endblock %} {% block content %}<div class="container" style="padding: 20px; max-width: 800px; margin: 0 auto">    <div class="wallet-header" style="text-align: center; margin-bottom: 30px">        <h2>Mon Portefeuille PMC</h2>        <div class="balance-card" style="background: #1a2a44; color: white; padding: 20px; border-radius: 15px; margin-top: 15px; display: none">            <p>Solde actuel</p>            <h1 style="color: #0f9d58">{{ format_money(current_user.solde) }} PMC</h1>        </div>    </div>    <div class="tabs" style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap">        <button class="tab-btn active" onclick="openTab(event, 'Acquisition')" style="flex: 1; padding: 10px; border: none; background: #ddd; border-radius: 8px; cursor: pointer; min-width: 80px">Acquisition</button>        <button class="tab-btn" onclick="openTab(event, 'Transfert')" style="flex: 1; padding: 10px; border: none; background: #ddd; border-radius: 8px; cursor: pointer; min-width: 80px">Transfert</button>        <button class="tab-btn" onclick="openTab(event, 'Infos')" style="flex: 1; padding: 10px; border: none; background: #ddd; border-radius: 8px; cursor: pointer; min-width: 80px">R√®gles</button>        <button class="tab-btn" onclick="openTab(event, 'History')" style="flex: 1; padding: 10px; border: none; background: #ddd; border-radius: 8px; cursor: pointer; min-width: 80px">Historique</button>    </div>    <div id="Acquisition" class="tab-content">        <div class="info-box" style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #0f9d58; display: flex; flex-direction: column; gap: 10px">            <h4>üì• Comment obtenir des Jetons ?</h4>            <p>Les recharges se font uniquement via nos interm√©diaires officiels.</p>            <hr style="border: 0; border-top: 1px solid #c8e6c9" />            <p>                <strong>Option 1 : Agents CIF</strong>                <br />                Trouvez un agent InterPam dans l'enceinte du coll√®ge.            </p>            <p>                <strong>Option 2 : WhatsApp</strong>                <br />                √âcrivez au num√©ro officiel :                <strong>+509 44 81 9817</strong>                .            </p>            <p style="font-size: 0.9em; color: #555">                <i>Aucune transaction d'argent r√©el n'est trait√©e sur ce site.</i>            </p>        </div>    </div>    <div id="Transfert" class="tab-content" style="display: none">        <div class="info-box" style="background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #2196f3">            <h4>üì§ Envoyer des PMC √† un ami</h4>            <p>                Soutenez un champion ou remboursez un ami. Des frais de                <b>{{ (config_global.frais_retrait * 100)|int }}%</b>                s'appliquent pour la cagnotte finale.            </p>        </div>        <form action="{{ url_for('transfert_route') }}" method="POST" onsubmit="return confirmTransfert()">            <div class="form-group" style="margin-bottom: 15px">                <label>Nom d'utilisateur du destinataire (Username)</label>                <input type="text" name="recipient_username" placeholder="Ex: PseudoDuChampion" required style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc" />                <small style="color: #d32f2f; font-weight: bold">‚ö†Ô∏è Attention : Sensible √† la casse (Majuscules/Minuscules importantes).</small>            </div>            <div class="form-group" style="margin-bottom: 15px">                <label>Montant √† envoyer (PMC)</label>                <input type="number" id="montant_transfert" name="montant" placeholder="Ex: 100" min="10" step="0.01" required style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc" oninput="calculerFrais()" />            </div>            <div id="resume-frais" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: none; font-size: 0.9em">                <div style="display: flex; justify-content: space-between">                    <span>Montant d√©bit√© de votre compte :</span>                    <span id="preview-brut" style="font-weight: bold">0 PMC</span>                </div>                <div style="display: flex; justify-content: space-between; color: #d32f2f">                    <span>Frais de gestion ({{ (config_global.frais_retrait * 100)|int }}%) :</span>                    <span id="preview-frais">0 PMC</span>                </div>                <hr style="border: 0; border-top: 1px solid #ddd; margin: 5px 0" />                <div style="display: flex; justify-content: space-between; color: #0f9d58; font-size: 1.1em; font-weight: bold">                    <span>Votre ami recevra :</span>                    <span id="preview-net">0 PMC</span>                </div>            </div>            <button type="submit" style="width: 100%; background: #2196f3; color: white; padding: 15px; border: none; border-radius: 8px; font-weight: bold">Valider le Transfert</button>        </form>    </div>    <div id="Infos" class="tab-content" style="display: none">        <div class="info-box" style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #ffc107">            <h4>‚ÑπÔ∏è √Ä savoir sur le Portefeuille</h4>            <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.6">                <li>                    <strong>Acquisition :</strong>                    Uniquement via Agents CIF ou WhatsApp (+509 44 81 9817).                </li>                <li>                    <strong>Transferts :</strong>                    Irr√©versibles. V√©rifiez bien le nom d'utilisateur (Username) avant d'envoyer.                </li>                <li>                    <strong>Frais :</strong>                    Les frais pr√©lev√©s sur les transferts alimentent la r√©compense des 3 premiers du classement (Top 10).                </li>                <li>                    <strong>S√©curit√© :</strong>                    Ne partagez jamais votre mot de passe, m√™me √† un agent.                </li>            </ul>            <p style="margin-top: 10px">                <a href="{{ url_for('legal') }}#transferts" style="color: #1a2a44; font-weight: bold">Voir le r√®glement complet ‚Üí</a>            </p>        </div>    </div>    <div id="History" class="tab-content" style="display: none">        {% if transactions %}        <table style="width: 100%; border-collapse: collapse">            <thead>                <tr style="border-bottom: 2px solid #ddd; text-align: left">                    <th style="padding: 10px">Type</th>                    <th>Montant</th>                    <th>Statut</th>                    <th>Date</th>                </tr>            </thead>            <tbody>                {% for t in transactions %}                <tr style="border-bottom: 1px solid #eee">                    <td style="padding: 10px">                        <span style="color: {{ 'green' if t.type == 'depot' or t.type == 'gain' else 'red' }}; font-weight:bold;">{{ t.type|upper }}</span>                    </td>                    <td>{{ format_money(t.montant)}} PMC</td>                    <td>                        {% if t.statut == 'en_attente' %}                        <span style="background: orange; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em">En attente</span>                        {% elif t.statut == 'valide' %}                        <span style="background: green; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em">Succ√®s</span>                        {% else %}                        <span style="background: red; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em">√âchec</span>                        {% endif %}                    </td>                    <td style="font-size: 0.8em; color: #666">{{ t.created_at[:10] }}</td>                </tr>                {% endfor %}            </tbody>        </table>        {% else %}        <p style="text-align: center; color: #666; margin-top: 20px">Aucune transaction r√©cente.</p>        {% endif %}    </div></div><script>    function openTab(evt, tabName) {        var i, tabcontent, tablinks;        tabcontent = document.getElementsByClassName("tab-content");        for (i = 0; i < tabcontent.length; i++) {            tabcontent[i].style.display = "none";        }        tablinks = document.getElementsByClassName("tab-btn");        for (i = 0; i < tablinks.length; i++) {            tablinks[i].style.backgroundColor = "#ddd";            tablinks[i].style.color = "black";        }        document.getElementById(tabName).style.display = "block";        evt.currentTarget.style.backgroundColor = "#1a2a44";        evt.currentTarget.style.color = "white";    }    // Ouvre le premier onglet par d√©faut    document.getElementsByClassName("tab-btn")[0].click();    // R√©cup√©ration de la variable Python dans le JS    const TAUX_FRAIS = {{ config_global.frais_retrait }};    function calculerFrais() {        const input = document.getElementById('montant_transfert');        const resume = document.getElementById('resume-frais');        const pBrut = document.getElementById('preview-brut');        const pFrais = document.getElementById('preview-frais');        const pNet = document.getElementById('preview-net');        let montant = parseFloat(input.value);        if (montant && montant > 0) {            let frais = montant * TAUX_FRAIS;            let net = montant - frais; // Le destinataire re√ßoit le montant moins les frais            pBrut.innerText = montant.toFixed(2) + " PMC";            pFrais.innerText = "-" + frais.toFixed(2) + " PMC";            pNet.innerText = net.toFixed(2) + " PMC";            resume.style.display = "block";        } else {            resume.style.display = "none";        }    }    function confirmTransfert() {        let montant = document.getElementById('montant_transfert').value;        let frais = (montant * TAUX_FRAIS).toFixed(2);        let net = (montant - frais).toFixed(2);        let user = document.querySelector('input[name="recipient_username"]').value;        return confirm(            `Confirmation de transfert vers : ${user}\n\n` +            `Montant d√©bit√© : ${montant} PMC\n` +            `Frais (Cagnotte) : ${frais} PMC\n` +            `Votre ami recevra : ${net} PMC\n\n` +            `Confirmer l'envoi ?`        );    }</script>{% endblock %}