{% extends 'base.html' %} {% block head %}<!--   <style type="text/css" media="all">        .top-bar{            display: none;        }    </style -->{% endblock %} {% block content %}<div class="container" style="padding: 20px; max-width: 800px; margin: 0 auto">    <div class="wallet-header" style="text-align: center; margin-bottom: 30px">        <h2>Mon Portefeuille</h2>        <div class="balance-card" style="background: #1a2a44; color: white; padding: 20px; border-radius: 15px; margin-top: 15px; display: none">            <p>Solde actuel</p>            <h1 style="color: #0f9d58">{{ format_money(current_user.solde) }} HTG</h1>        </div>    </div>    <div class="tabs" style="display: flex; gap: 10px; margin-bottom: 20px">        <button class="tab-btn active" onclick="openTab(event, 'Depot')" style="flex: 1; padding: 10px; border: none; background: #ddd; border-radius: 8px; cursor: pointer">Dépôt</button>        <button class="tab-btn" onclick="openTab(event, 'Retrait')" style="flex: 1; padding: 10px; border: none; background: #ddd; border-radius: 8px; cursor: pointer">Retrait</button>        <button class="tab-btn" onclick="openTab(event, 'History')" style="flex: 1; padding: 10px; border: none; background: #ddd; border-radius: 8px; cursor: pointer">Historique</button>    </div>    <div id="Depot" class="tab-content">        <div class="info-box" style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #0f9d58; display: flex; flex-direction: column; gap: 10px;">            <h4>Instructions MonCash</h4>            <p>1. Envoyez le montant au <strong>+509 44 81 9817</strong>.</p>            <p>2. Copiez l'ID de transaction reçu par SMS.</p>            <p>3. Remplissez le formulaire ci-dessous.</p>            <p>                <b>Note :</b> Une erreur dans le formulaire peut retarder le transfert.                <a href="{{ url_for('legal') }}#transferts" style="color:#557;">Plus d'informations…</a>            </p>        </div>        <form action="{{ url_for('demande_depot') }}" method="POST">            <div class="form-group" style="margin-bottom: 15px">                <label>Numéro MonCash émetteur</label>                <input type="number" name="telephone" placeholder="Ex: 36001234" min-length="8" required style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc" />            </div>            <div class="form-group" style="margin-bottom: 15px">                <label>ID de Transaction (Reçu par SMS)</label>                <input type="text" name="moncash_id" placeholder="Ex: 202..." required style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc" />            </div>            <div class="form-group" style="margin-bottom: 15px">                <label>Montant (HTG)</label>                <input type="number" name="montant" placeholder="500" min="10" required style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc" />            </div>            <button type="submit" style="width: 100%; background: #0f9d58; color: white; padding: 15px; border: none; border-radius: 8px; font-weight: bold">Confirmer le Dépôt</button>        </form>    </div>    <div id="Retrait" class="tab-content" style="display: none">        <div class="info-box" style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid #ffc107">            <h4>Demande de Retrait</h4>            <p>Le montant (plus frais de <b>{{ (frais_retrait * 100)|int }}%</b>) sera déduit de votre solde.</p>        </div>                <form action="{{ url_for('demande_retrait') }}" method="POST" onsubmit="return confirmRetrait()">            <div class="form-group" style="margin-bottom: 15px">                <label>Numéro MonCash récepteur</label>                <input type="number" name="telephone" placeholder="Ex: 36001234" required style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc" />            </div>                        <div class="form-group" style="margin-bottom: 15px">                <label>Montant à retirer (HTG)</label>                <input type="number" id="montant_retrait" name="montant" placeholder="500" min="50" min-length="8" required                        style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc"                       oninput="calculerFrais()" />            </div>            <div id="resume-frais" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; display:none; font-size: 0.9em;">                <div style="display: flex; justify-content: space-between;">                    <span>Montant débité :</span>                    <span id="preview-brut" style="font-weight: bold;">0 HTG</span>                </div>                <div style="display: flex; justify-content: space-between; color: #d32f2f;">                    <span>Frais ({{ (frais_retrait * 100)|int }}%) :</span>                    <span id="preview-frais">0 HTG</span>                </div>                <hr style="border: 0; border-top: 1px solid #ddd; margin: 5px 0;">                <div style="display: flex; justify-content: space-between; color: #0f9d58; font-size: 1.1em; font-weight: bold;">                    <span>Vous recevrez :</span>                    <span id="preview-net">0 HTG</span>                </div>            </div>            <button type="submit" style="width: 100%; background: #d32f2f; color: white; padding: 15px; border: none; border-radius: 8px; font-weight: bold">Demander le Retrait</button>        </form>    </div>    <div id="History" class="tab-content" style="display: none">        {% if transactions %}        <table style="width: 100%; border-collapse: collapse">            <thead>                <tr style="border-bottom: 2px solid #ddd; text-align: left">                    <th style="padding: 10px">Type</th>                    <th>Montant</th>                    <th>Statut</th>                    <th>Date</th>                </tr>            </thead>            <tbody>                {% for t in transactions %}                <tr style="border-bottom: 1px solid #eee">                    <td style="padding: 10px">                        <span style="color: {{ 'green' if t.type == 'depot' else 'red' }}; font-weight:bold;">{{ t.type|upper }}</span>                    </td>                    <td>{{ format_money(t.montant)}} HTG</td>                    <td>                        {% if t.statut == 'en_attente' %}                        <span style="background: orange; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em">En attente</span>                        {% elif t.statut == 'valide' %}                        <span style="background: green; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em">Validé</span>                        {% else %}                        <span style="background: red; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em">Refusé</span>                        {% endif %}                    </td>                    <td style="font-size: 0.8em; color: #666">{{ t.created_at[:10] }}</td>                </tr>                {% endfor %}            </tbody>        </table>        {% else %}        <p style="text-align: center; color: #666; margin-top: 20px">Aucune transaction.</p>        {% endif %}    </div></div><script>    function openTab(evt, tabName) {        var i, tabcontent, tablinks;        tabcontent = document.getElementsByClassName("tab-content");        for (i = 0; i < tabcontent.length; i++) {            tabcontent[i].style.display = "none";        }        tablinks = document.getElementsByClassName("tab-btn");        for (i = 0; i < tablinks.length; i++) {            tablinks[i].style.backgroundColor = "#ddd";            tablinks[i].style.color = "black";        }        document.getElementById(tabName).style.display = "block";        evt.currentTarget.style.backgroundColor = "#1a2a44";        evt.currentTarget.style.color = "white";    }    // Open default tab    document.getElementsByClassName("tab-btn")[0].click();            // Récupération de la variable Python dans le JS    const TAUX_FRAIS = {{ frais_retrait }};     function calculerFrais() {        const input = document.getElementById('montant_retrait');        const resume = document.getElementById('resume-frais');        const pBrut = document.getElementById('preview-brut');        const pFrais = document.getElementById('preview-frais');        const pNet = document.getElementById('preview-net');        let montant = parseFloat(input.value);        if (montant && montant > 0) {            let frais = montant * TAUX_FRAIS;            let net = montant - frais;            pBrut.innerText = montant.toFixed(2) + " HTG";            pFrais.innerText = "-" + frais.toFixed(2) + " HTG";            pNet.innerText = net.toFixed(2) + " HTG";            resume.style.display = "block";        } else {            resume.style.display = "none";        }    }    function confirmRetrait() {        let montant = document.getElementById('montant_retrait').value;        let frais = (montant * TAUX_FRAIS).toFixed(2);        let net = (montant - frais).toFixed(2);                return confirm(            `Confirmation de retrait :\n\n` +            `Montant débité : ${montant} HTG\n` +            `Frais : ${frais} HTG\n` +            `Net à recevoir : ${net} HTG\n\n` +            `Confirmer la demande ?`        );    }</script>{% endblock %}