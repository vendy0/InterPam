<!-- @format -->{% extends 'admin/base.html' %} {% block content %}<ul>    <h3>Rechercher</h3>    <!-- <li><a href="{{ url_for('users.find_user') }}">Trouver un utilisateur</a></li> -->    <form action="{{ url_for('users.find_user') }}" method="POST">        <input type="text" name="nom" id="name" placeholder="Récupérer utilisateur par nom" value="{{ request.form.nom }}" />        <input type="text" name="username_finding" id="username_finding" placeholder="Récupérer utilisateur par username" value="{{ request.form.username_finding }}" />        <input type="text" name="email" id="email" placeholder="Récupérer utilisateur par email" value="{{ request.form.email }}" />        <input type="number" name="age" id="age" placeholder="Récupérer utilisateur par age" value="{{ request.form.age }}" />        <select class="classe_input" name="classe">            <option value="" selected="selected">Classe</option>            <option value="septieme" {% if request.form.classe=="septieme" %} selected="selected" {% endif %}>7e A.F.</option>            <option value="huitieme" {% if request.form.classe=="huitieme" %} selected="selected" {%endif%}>8e A.F.</option>            <option value="neuvieme" {% if request.form.classe=="neuvieme" %} selected="selected" {%endif%}>9e A.F.</option>            <option value="secondaire 1" {% if request.form.classe=="secondaire 1" %} selected="selected" {%endif%}>NS1</option>            <option value="secondaire 2" {% if request.form.classe=="secondaire 2" %} selected="selected" {%endif%}>NS2</option>            <option value="secondaire 3" {% if request.form.classe=="secondaire 3" %} selected="selected" {%endif%}>NS3</option>            <option value="secondaire 4" {% if request.form.classe=="secondaire 4" %} selected="selected" {%endif%}>NS4</option>            <option value="Direction" {% if request.form.classe=="Direction" %} selected="selected" {%endif%}>Direction</option>        </select>        <button type="submit" name="action">Rechercher</button>    </form>    <hr />    {% if no_users %}    <h3>Aucun utilisateur ne correspond à la recherche</h3>    {% elif users %}    <h3>Résultats trouvés ({{ users|length }})</h3>    <div class="results-table" style="background: white; padding: 20px; border-radius: 8px">        <table border="1" style="width: 100%; border-collapse: collapse">            <thead style="background-color: #1e3a8a; color: white">                <tr>                    <th>Nom Complet</th>                    <th class="username_col">Username</th>                    <th>Email</th>                    <th>Classe</th>                    <th>Solde</th>                    <th>Rôle</th>                    <th>Action</th>                </tr>            </thead>            <tbody>                {% for user in users %}                <tr>                    <td>{{ user['prenom'] }} {{ user['nom'] }}</td>                    <td><strong>@{{ user['username'] }}</strong></td>                    <td>{{ user['email'] }}</td>                    <td>{{ user['classe'] }}</td>                    <td>{{ user['solde'] / 100 }} HTG</td>                    <td>{{ user['role'] }}</td>                    <td>                        <a href="#" onclick="preRemplirCredit('{{ user['username'] }}')" style="color: #1e3a8a; font-weight: bold; text-decoration: underline; cursor: pointer">Créditer</a>                        <a href="#" onclick="preRemplirDebit('{{ user['username'] }}')" style="color: #1e3a8a; font-weight: bold; text-decoration: underline; cursor: pointer">Débiter</a>                        <a href="javascript:void(0)" onclick="confirmBan({{ user['username'] }})" style="color: #dc2626; margin-left: 10px; font-weight: bold;">Bannir</a>                    </td>                </tr>                {% endfor %}            </tbody>        </table>    </div>    {% endif %}    <hr />    <h3>Créditer</h3>    <!-- <li><a href="{{ url_for('users.credit_user') }}">Créditer</a></li> -->    <form id="form-credit" action="{{ url_for('users.credit_user') }}" method="POST">        <input type="text" name="username_credit" id="username_credit" placeholder="Username" />        <input type="number" name="solde_credit" id="solde_credit" step="any" placeholder="Somme à ajouter" />        <button type="submit">Valider le crédit</button>    </form>    <hr />    <h3>Débiter</h3>    <!-- <li><a href="{{ url_for('users.credit_user') }}">Créditer</a></li> -->    <form id="form-credit" action="{{ url_for('users.debit_user') }}" method="POST">        <input type="text" name="username_debit" id="username_debit" placeholder="Username" />        <input type="number" name="solde_debit" id="solde_debit" step="any" placeholder="Somme à retirer" />        <button type="submit">Valider le débit</button>    </form></ul><div id="deleteModal" style="display:none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center;">    <div style="background: white; padding: 25px; border-radius: 8px; width: 350px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">        <h4 style="margin-top: 0;">Confirmer la suppression</h4>        <p style="font-size: 0.9em; color: #666;">Cette action est irréversible. Entrez votre mot de passe :</p>                <form id="deleteForm" method="POST">            <input type="text" name="username" required placeholder="Username" style="width: 100%; padding: 10px; margin: 15px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">            <input type="password" name="password" required placeholder="Mot de passe" style="width: 100%; padding: 10px; margin: 15px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;">                        <div style="display: flex; gap: 10px; justify-content: center;">                <button type="button" onclick="closeDeleteModal()" style="padding: 8px 15px; border-radius: 4px; border: 1px solid #ccc; cursor: pointer;">Annuler</button>                <button type="submit" style="padding: 8px 15px; border-radius: 4px; border: none; background: #dc2626; color: white; cursor: pointer;">Supprimer</button>            </div>        </form>    </div></div><script>    function preRemplirCredit(username) {        // On récupère le champ username du formulaire de crédit        const inputCredit = document.getElementById("username_credit");        const inputSommeCredit = document.getElementById("solde_credit");        if (inputCredit) {            inputCredit.value = username; // On injecte le nom            inputSommeCredit.focus(); // On place directement le curseur sur le montant pour gagner du temps        }    }    function preRemplirDebit(username) {        // On récupère le champ username du formulaire de crédit        const inputDebit = document.getElementById("username_debit");        const inputSommeDebit = document.getElementById("solde_debit");        if (inputDebit) {            inputDebit.value = username; // On injecte le nom            inputSommeDebit.focus(); // On place directement le curseur sur le montant pour gagner du temps        }    }    const modal = document.getElementById('deleteModal');    const form = document.getElementById('deleteForm');    function confirmBan(username) {        // Définit l'URL d'action du formulaire dynamiquement        form.action = `/admin/users/ban/${username}`;        // Affiche la modale        modal.style.display = 'flex';    }    function closeDeleteModal() {        modal.style.display = 'none';        form.reset();    }    // Fermer si on clique en dehors de la modale    window.onclick = function(event) {        if (event.target == modal) closeDeleteModal();    }</script>{%endblock%}