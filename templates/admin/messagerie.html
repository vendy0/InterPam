{% extends "admin/base.html" %} {% block content %}    <h2 class="header-actions">Messagerie Administration</h3><div class="filter-container" style="margin-top: 20px">    <button class="filter-btn active" data-filter="tous">        Tous        <span class="filter-count" id="count-tous"></span>    </button>    <button class="filter-btn" data-filter="non-lu">        Non lus        <span class="filter-count" id="count-non-lu"></span>    </button>    <button class="filter-btn" data-filter="lu">        Lus        <span class="filter-count" id="count-lu"></span>    </button></div>{% if messages %}<div class="messages-list" style="margin-top: 20px; display: flex; flex-direction: column; gap: 12px">    {% for message in messages %} {% set status_class = 'non-lu' if message['read'] == 1 else 'lu' %}    <div class="message-card {{ status_class }}" data-statut="{{ status_class }}">        <details class="admin-filter">            <summary>                <div style="display: flex; flex-direction: column; gap: 4px">                    <span style="font-weight: 700; color: var(--admin-primary)">{% if message.prenom %} {{ message.prenom }} {{ message.nom }} {% else %} Utilisateur supprimé {% endif %}</span>                    <span style="font-size: 0.75rem; color: #64748b">{{ set_date(message['created_at']) }}</span>                </div>                {% if message['read'] == 1 %}                <span class="badge-new">NEW</span>                {% endif %}            </summary>            <div class="filter-content">                <p style="white-space: pre-wrap; margin-bottom: 15px; line-height: 1.5">{{ message['message'] }}</p>                <div style="display: flex; gap: 10px; border-top: 1px solid #eee; padding-top: 15px">                    <a href="{{ url_for('users.find_user', user_id=message['parieur_id']) }}" class="btn-primary" style="font-size: 0.8rem; padding: 8px 12px">Profil Joueur</a>                    {% if message['read'] == 1 %}                    <a href="{{ url_for('admin.mark_as_read_route', message_id=message['id']) }}" class="btn-success" style="font-size: 0.8rem; padding: 8px 12px">Marquer comme lu</a>                    {% endif %}                </div>            </div>        </details>    </div>    {% endfor %}</div>{% else %}<div style="text-align: center; padding: 50px; color: #64748b">Aucun message reçu.</div>{% endif %}<style>    /* Spécifique Messagerie */    .badge-new {        background: var(--admin-danger);        color: white;        font-size: 0.65rem;        padding: 2px 6px;        border-radius: 4px;        font-weight: bold;    }    .message-card.lu {        opacity: 0.7;    }    .message-card.hidden {        display: none;    }    /* On réutilise tes styles de filtres de fiches.css */</style><script>    document.addEventListener("DOMContentLoaded", function () {        const filters = document.querySelectorAll(".filter-btn");        const cards = document.querySelectorAll(".message-card");        function updateCounts() {            const counts = { tous: cards.length, "non-lu": 0, lu: 0 };            cards.forEach(card => {                const s = card.getAttribute("data-statut");                if (counts.hasOwnProperty(s)) counts[s]++;            });            document.getElementById("count-tous").textContent = `(${counts["tous"]})`;            document.getElementById("count-non-lu").textContent = `(${counts["non-lu"]})`;            document.getElementById("count-lu").textContent = `(${counts["lu"]})`;        }        filters.forEach(button => {            button.addEventListener("click", () => {                filters.forEach(btn => btn.classList.remove("active"));                button.classList.add("active");                const val = button.getAttribute("data-filter");                cards.forEach(card => {                    if (val === "tous" || card.getAttribute("data-statut") === val) {                        card.classList.remove("hidden");                    } else {                        card.classList.add("hidden");                    }                });            });        });        updateCounts();    });</script>{% endblock %}