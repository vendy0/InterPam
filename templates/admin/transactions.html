{% extends 'admin/base.html' %} {# Assure toi d'√©tendre ton layout admin existant, ou base.html si tu n'as pas de layout sp√©cifique admin #} {% block content %}<div class="admin-container" style="padding: 20px">    <h2 class="header-actions">Gestion des Transactions (MonCash)</h2>    {% if demandes %}    <div style="overflow-x: auto">        <table style="width: 100%; border-collapse: collapse; background: white; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1)">            <thead style="background: #333; color: white">                <tr>                    <th style="padding: 10px">Utilisateur</th>                    <th>Type</th>                    <th>Montant</th>                    <th>Infos (MonCash/T√©l)</th>                    <th>Date</th>                    <th>Action</th>                    <th>V√©rification</th>                </tr>            </thead>            <tbody>                {% for d in demandes %}                <tr style="border-bottom: 1px solid #ddd">                    <td style="padding: 10px">                        <strong>{{ d.username }}</strong>                        <br />                        <small>{{ d.prenom }} {{ d.nom }}</small>                    </td>                    <td>                        <span style="font-weight:bold; color: {{ 'green' if d.type == 'depot' else 'red' }};">{{ d.type|upper }}</span>                    </td>                    <td>{{ d.montant }} HTG</td>                    <td>                        T√©l:                        <strong>{{ d.telephone }}</strong>                        {% if d.type == 'depot' %}                        <br />                        ID:                        <span style="background: #eee; padding: 2px">{{ d.moncash_id }}</span>                        {% endif %}                    </td>                    <td>{{ d.created_at }}</td>                    <td style="padding: 10px">                        <form action="{{ url_for('admin.transaction_action') }}" method="POST" style="display: flex; gap: 5px">                            <input type="hidden" name="tx_id" value="{{ d.id }}" />                            <button type="submit" name="action" value="valider" style="background: green; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer" onclick="return confirm('Confirmer cette transaction ?');">‚úì Valider</button>                            <button type="button" onclick="showReject('{{ d.id }}')" style="background: red; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer">X Refuser</button>                            <input type="text" name="raison" id="raison_{{d.id}}" placeholder="Raison refus" style="display: none; width: 100px" />                            <button type="submit" name="action" value="refuser" id="btn_refuse_{{d.id}}" style="display: none; background: #d32f2f; color: white; border: none; padding: 5px">Confirmer Refus</button>                        </form>                    </td>                    <td style="background: #f9f9f9; border: 1px dashed #ccc; padding: 10px;">    					<textarea id="sms_input_{{ d.id }}" placeholder="Coller le SMS MonCash ici..." style="width:100%; height:40px; font-size: 11px;"></textarea>    					<button type="button" onclick="checkWithIA('{{ d.id }}')" style="font-size: 10px; margin-top:5px; background: #6c5ce7; color:white; border:none; padding:5px; border-radius:3px; cursor:pointer;">    						ü§ñ V√©rifier par IA    					</button>    					<div id="result_ia_{{ d.id }}" style="margin-top:5px; font-size: 11px; font-weight: bold;"></div>					</td>                </tr>                {% endfor %}            </tbody>        </table>    </div>    {% else %}    <p>Aucune transaction en attente.</p>    {% endif %}</div><script>function checkWithIA(txId) {    const sms = document.getElementById('sms_input_' + txId).value;    const resultDiv = document.getElementById('result_ia_' + txId);        if(!sms) return alert("Collez le SMS d'abord !");        resultDiv.innerHTML = "‚åõ Analyse en cours...";    resultDiv.style.color = "blue";    fetch('/admin/ia-check', {        method: 'POST',        headers: {'Content-Type': 'application/json'},        body: JSON.stringify({ sms: sms, tx_id: txId })    })    .then(response => response.json())    .then(data => {        if(data.verdict === "VALIDE") {            resultDiv.innerHTML = "‚úÖ " + data.commentaire + " (Confiance: " + data.confiance + "%)";            resultDiv.style.color = "green";        } else {            resultDiv.innerHTML = "‚ùå " + data.commentaire;            resultDiv.style.color = "red";        }    })    .catch(err => {        resultDiv.innerHTML = "‚ö†Ô∏è Erreur de connexion";    });}</script><script>    function showReject(id) {        // Affiche le champ raison et le bouton de confirmation de refus        document.getElementById("raison_" + id).style.display = "inline-block";        document.getElementById("btn_refuse_" + id).style.display = "inline-block";    }</script>{% endblock %}